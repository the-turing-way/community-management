
name: Create Slack Monthly Management Issue

on:
  workflow_dispatch:
  schedule:
    - cron: "0 9 1 * *"  # runs on the 1st of every month at 09:00 UTC

jobs:
  create_and_add_issue:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      repository-projects: write
      contents: read

    steps:
      - name: Create Slack Monthly Management Issue
        id: create_issue
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          ISSUE_URL=$(gh issue create \
            --repo "${{ github.repository }}" \
            --title "ðŸ“… Slack planning and management issueâ€” $(date --date="+2 months" +"%B %Y")" \
            --body "This is your automatic monthly issue to manage TTW Slack! ðŸ› ï¸
          Checklist to review and work on this month:
          - [ ] Who's owning slack management this month? Assign yourself!
          - [ ] *Announcements*: post things and events to highlight in this channel 2X a month
              - [ ] WG meetings according to TTW Calendar 
              - [ ] any TTW-related events?
              - [ ] Collab cafes and onboarding dates!
          ")
          echo "issue_url=$ISSUE_URL" >> $GITHUB_OUTPUT
      - name: Add issue to GitHub project
        uses: actions/add-to-project@v0.4.0
        with:
          project-url: https://github.com/orgs/the-turing-way/projects/12
          github-token: ${{ secrets.GITHUB_TOKEN }}
        env:
          # add-to-project action uses GH_TOKEN as fallback
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
